@page
@model AzureRag.Pages.DataStructuringModel
@{
    ViewData["Title"] = "ILUデータ構造化ソリューション 合成データ作成環境";
    Layout = null;
}
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"]</title>
    <link rel="shortcut icon" href="/demo-app2/images/ilu-logo.png" />
    <link rel="stylesheet" href="/demo-app2/css/data-structuring.css" />
    <!-- 形態素解析ライブラリは使用しない -->
    <!-- フォントアイコン用のFont Awesome追加 -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <!-- JSZip と FileSaver ライブラリを追加 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
</head>
<body>

<div class="data-structuring-container">
    <!-- ヘッダー -->
    <header class="ds-header" style="position: relative;">
        <div class="header-logo">
            <a href="@Url.Content("~/DataStructuring")" style="text-decoration: none; display: flex; align-items: center; color: inherit;">
                <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iNDMiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0iTTguNzQ3IDQzSDBMMjMuMjU3IDBIMzJMOC43NDcgNDNaIiBmaWxsPSJ1cmwoI2EpIi8+PGRlZnM+PGxpbmVhckdyYWRpZW50IGlkPSJhIiB4MT0iMCIgeTE9IjIxLjUwMiIgeDI9IjMyIiB5Mj0iMjEuNTAyIiBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSI+PHN0b3Agc3RvcC1jb2xvcj0iIzBENTdBNyIvPjxzdG9wIG9mZnNldD0iLjUiIHN0b3AtY29sb3I9IiMzMzg5Q0EiLz48c3RvcCBvZmZzZXQ9IjEiIHN0b3AtY29sb3I9IiM3MUJDRTkiLz48L2xpbmVhckdyYWRpZW50PjwvZGVmcz48L3N2Zz4=" width="32" height="43" alt="ILUロゴ" />
                <span class="header-title" style="font-size: 1.5rem !important;"><strong>ILUデータ構造化ソリューション 合成データ作成環境</strong></span>
            </a>
        </div>
        <div style="margin-left: auto; display: flex; gap: 15px; align-items: center;">
            <!-- 全ページ検索窓を追加 -->
            <!-- コメントアウト：全ページ検索を非表示
            <div id="global-search-container" style="position: relative; display: flex; align-items: center; border: 1px solid #d1d5db; border-radius: 4px; overflow: hidden; margin-right: 10px;">
                <input type="text" id="global-search-input" placeholder="全ページを検索..." style="padding: 6px 12px; padding-left: 32px; border: none; outline: none; width: 200px; font-size: 14px;">
                <i class="fas fa-search" style="position: absolute; left: 10px; color: #6b7280;"></i>
            </div>
            -->
            <!-- 一括ダウンロードボタン -->
            <button id="batch-download-btn" class="header-button" style="display: flex; align-items: center; background-color: #f9fafb; border: 1px solid #d1d5db; border-radius: 6px; padding: 0.375rem 0.75rem; cursor: pointer; font-size: 0.875rem;">
                <i class="fas fa-download" style="margin-right: 5px;"></i>一括ダウンロード
            </button>
            
            <!-- アップロード状況ボタン -->
            <button id="upload-status-btn" class="header-button" style="display: flex; align-items: center; background-color: #f9fafb; border: 1px solid #d1d5db; border-radius: 6px; padding: 0.375rem 0.75rem; cursor: pointer; font-size: 0.875rem;">
                <i class="fas fa-history" style="margin-right: 5px;"></i>アップロード状況
            </button>
            
            <!-- 設定ボタン -->
            <button id="settings-btn" class="header-button" style="display: flex; align-items: center; background-color: #f9fafb; border: 1px solid #d1d5db; border-radius: 6px; padding: 0.375rem 0.75rem; cursor: pointer; font-size: 0.875rem;">
                <i class="fas fa-cog" style="margin-right: 5px;"></i>設定
            </button>
            
            <!-- アカウントアイコン -->
            <div id="account-icon" style="width: 36px; height: 36px; border-radius: 50%; background-color: #3389ca; color: white; display: flex; align-items: center; justify-content: center; cursor: pointer; font-weight: bold; transition: background-color 0.2s; user-select: none;" 
                 onmouseover="this.style.backgroundColor='#2563eb'" 
                 onmouseout="this.style.backgroundColor='#3389ca'">
                U
            </div>
            
            <!-- アカウントドロップダウンメニュー (初期状態では非表示) -->
            <div id="account-dropdown" style="display: none; position: absolute; right: 16px; top: 60px; background-color: white; border-radius: 8px; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15); width: 200px; z-index: 1000;">
                <div style="padding: 12px 16px; border-bottom: 1px solid #e5e7eb;">
                    <div style="font-weight: 500;">ユーザー</div>
                    <div style="font-size: 0.875rem; color: #6b7280;">ログイン中</div>
                </div>
                <div style="padding: 8px;">
                    <a href="#" onclick="return logout();" style="display: block; padding: 8px 16px; color: #ef4444; text-decoration: none; border-radius: 4px;">
                        <i class="fas fa-sign-out-alt" style="margin-right: 8px;"></i>ログアウト
                    </a>
                </div>
            </div>
            
            <!-- デバッグリンク（開発用、必要に応じて削除可能） -->
            <div style="display: none;">
                            <a href="/demo-app2/api/data-structuring/logs" target="_blank" style="text-decoration: none; color: #3389ca; font-size: 0.875rem; display: flex; align-items: center;">
                <i class="far fa-file-alt" style="margin-right: 5px;"></i>システムログ
            </a>
            <a href="/demo-app2/api/data-structuring/debug-logs" target="_blank" style="text-decoration: none; color: #d97706; font-size: 0.875rem; display: flex; align-items: center;">
                <i class="fas fa-bug" style="margin-right: 5px;"></i>デバッグログ
            </a>
            </div>
        </div>
    </header>

    <!-- メインレイアウト -->
    <div class="main-container">
        <!-- 左サイドバー -->
        <div class="left-sidebar" id="leftSidebar">
            <div class="left-resizer" id="leftResizer"></div>
            <button class="upload-btn" id="upload-btn">アップロード</button>
            <!-- 現在のファイル表示（PDF名リンク） -->
            <div id="current-file" style="display:none; padding: 8px 12px; border-bottom: 1px solid #e5e7eb;">
                <i class="fas fa-file-pdf" style="margin-right: 6px; color:#ef4444;"></i>
                <a id="current-file-link" href="#" target="_blank" rel="noopener" style="text-decoration:none; color:#2563eb;">-</a>
            </div>
            <div class="page-list-header">ページ一覧</div>
            <div class="page-list" id="page-list">
                <!-- ページリストはJavaScriptで動的に生成 -->
            </div>
            
            <!-- シノニム一覧セクション - 非表示
            <div class="synonym-section">
                <div class="synonym-list-header">シノニム一覧</div>
                <div class="synonym-list" id="synonym-list">
                    <div class="synonym-item" data-type="api" id="api-synonym-item">
                        <i class="fas fa-cloud" style="margin-right: 8px; color: #3389ca;"></i>
                        APIシノニム
                    </div>
                    <div class="synonym-item" data-type="manual" id="manual-synonym-item">
                        <i class="fas fa-edit" style="margin-right: 8px; color: #059669;"></i>
                        手動シノニム
                    </div>
                    <div class="synonym-item" data-type="combined" id="combined-synonym-item">
                        <i class="fas fa-layer-group" style="margin-right: 8px; color: #dc2626;"></i>
                        統合シノニム
                    </div>
                </div>
            </div>
            -->
        </div>

        <!-- コンテンツエリア -->
        <div class="content-area">
            <div class="content-toolbar">
                <div>
                    <h1 id="documentTitle"></h1>
                    <p id="documentMeta"></p>
                </div>
                <div class="toolbar-actions">
                    <button class="toolbar-btn chat-btn" id="diff-analyze-btn" style="margin-right: 8px;">差分分析</button>
                    <button class="toolbar-btn download-btn" id="download-btn">ダウンロード</button>
                    <button class="toolbar-btn chat-btn" id="chatToggleBtn">チャット</button>
                </div>
            </div>
            
            <div class="document-content">
                <div class="document-inner" id="document-content">
                    <!-- ドキュメントコンテンツはJavaScriptで動的に生成 -->
                    <div class="empty-state">
                    </div>
                </div>
            </div>
        </div>

        <!-- 右サイドバー（チャット / 差分） -->
        <div class="right-sidebar" id="rightSidebar">
            <div class="right-resizer" id="rightResizer"></div>
            <div class="chat-header">
                <div id="right-panel-title">AIアシスタント</div>
                <div style="display:flex; gap:8px; align-items:center;">
                    <button id="open-synth-btn" class="toolbar-btn chat-btn" style="display:none; padding: 0.25rem 0.5rem; font-size: 0.8rem;">合成データ作成</button>
                    <button class="close-btn" id="close-chat-btn">×</button>
                </div>
            </div>
            
            <div class="chat-messages" id="chat-messages">
                <!-- システムメッセージ -->
                <div class="chat-message">
                    <div class="avatar system-avatar">I</div>
                    <div class="message-bubble system-bubble">
                        <p>こんにちは！AIアシスタントです。どのようにお手伝いできますか？</p>
                    </div>
                </div>
            </div>

            <!-- 差分結果表示エリア（初期は非表示、差分モードで使用） -->
            <div id="diff-results" style="display:none; max-height: calc(100% - 48px); overflow: auto; padding: 12px;"></div>
            
            <div class="chat-input-container">
                <div class="chat-input-wrapper">
                    <input type="text" class="chat-input" id="chat-input" placeholder="メッセージを入力...">
                    <button class="chat-send-btn" id="chat-send-btn" type="button" disabled>
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>
                <div class="chat-input-info">
                    レスポンスは登録した全ドキュメントの内容に基づいて生成されます
                </div>
            </div>
        </div>
    </div>
</div>

    <script src="/demo-app2/js/document-storage.js"></script>
    <script src="/demo-app2/js/data-structuring.js"></script>

    <!-- 合成データ生成モーダル（ドラッグ可・背景グレーアウトなし） -->
    <div id="synth-modal" style="display:none; position: fixed; top: 64px; right: 32px; width: 560px; max-width: 90vw; background:#fff; border:1px solid #e5e7eb; border-radius:8px; box-shadow:0 10px 25px rgba(0,0,0,.15); z-index: 1200;">
        <div id="synth-modal-header" style="cursor: move; display:flex; align-items:center; justify-content: space-between; padding:10px 12px; border-bottom:1px solid #e5e7eb; background:#f9fafb; border-radius:8px 8px 0 0;">
            <div style="font-weight:600;">合成データ（JSONL）生成</div>
            <button id="synth-modal-close" style="background:none; border:none; font-size:1.1rem; cursor:pointer;">×</button>
        </div>
        <div style="padding:12px; display:flex; flex-direction: column; gap:8px;">
            <div style="display:flex; gap:8px; align-items:center;">
                <label style="font-size:.9rem; color:#374151;">件数</label>
                <input type="number" id="synth-samples" min="1" max="10" value="3" style="width:80px; padding:6px; border:1px solid #d1d5db; border-radius:6px;" />
                <button id="synth-generate-btn" class="toolbar-btn chat-btn" style="padding: 6px 10px;">生成</button>
                <button id="synth-download-btn" class="toolbar-btn download-btn" style="padding: 6px 10px;">ダウンロード</button>
            </div>
            <textarea id="synth-jsonl" style="width:100%; height: 260px; border:1px solid #e5e7eb; border-radius:6px; padding:8px; font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace;"></textarea>
        </div>
    </div>

<!-- 差分分析モーダル -->
<div id="diff-modal" class="modal" style="display:none; position: fixed; top:0; left:0; width:100%; height:100%; background-color: rgba(0,0,0,.5); z-index:1000;">
    <div class="modal-content" style="background:#fff; margin: 3% auto; padding: 16px; width: 92%; max-width: 1400px; border-radius: 8px; position: relative;">
        <div class="modal-header" style="display:flex; justify-content: space-between; align-items:center; border-bottom:1px solid #e5e7eb; padding-bottom: 10px;">
            <h2 style="margin:0; font-size:1.25rem;">元文書との比較差分</h2>
            <div style="display:flex; gap:8px; align-items:center;">
                <button id="diff-modal-close" aria-label="close" style="background:none; border:none; font-size:1.25rem; cursor:pointer;">×</button>
            </div>
        </div>
        <div class="modal-body" style="padding-top:12px;">
            <div id="page-diff-list" style="border:1px solid #e5e7eb; border-radius:8px; min-height:240px; max-height:70vh; overflow:auto;">
                <!-- 差分本文（ページ順） -->
            </div>
        </div>
    </div>
</div>

<!-- アップロードオプション（fewshot） -->
<div id="upload-options" style="display:flex; align-items:center; gap:8px; padding: 8px 12px;">
    <label style="display:flex; align-items:center; gap:6px; font-size:.9rem;">
        <input type="checkbox" id="opt-fewshot" /> fewshot学習する
    </label>
    <select id="fewshot-type" style="display:none; padding:6px; border:1px solid #d1d5db; border-radius:4px;">
        <option value="">タイプを選択</option>
    </select>
</div>

<!-- アップロード状況モーダル -->
<div id="upload-status-modal" class="modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.5); z-index: 1000; overflow: auto;">
    <div class="modal-content" style="background-color: #fff; margin: 5% auto; padding: 20px; width: 80%; max-width: 1200px; border-radius: 8px; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); position: relative;">
        <div class="modal-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; border-bottom: 1px solid #e5e7eb; padding-bottom: 15px;">
            <h2 style="margin: 0; font-size: 1.5rem; color: #111827;">アップロード状況一覧</h2>
            <div style="display: flex; align-items: center; gap: 10px;">
                <button id="refresh-upload-status" style="background-color: #3389ca; color: white; border: none; border-radius: 4px; padding: 6px 12px; cursor: pointer; font-size: 0.875rem; display: flex; align-items: center; gap: 5px;">
                    <i class="fas fa-sync"></i>更新
                </button>
                <button id="close-upload-modal" style="background: none; border: none; cursor: pointer; font-size: 1.5rem; color: #6b7280;">&times;</button>
            </div>
        </div>
        <div class="modal-body">
            <div class="upload-status-header" style="display: grid; grid-template-columns: 1fr 2fr 1fr 1fr; gap: 16px; font-weight: bold; padding: 10px 0; border-bottom: 1px solid #e5e7eb; margin-bottom: 10px;">
                <div>処理ID</div>
                <div>ファイル名</div>
                <div>アップロード日時</div>
                <div>操作</div>
            </div>
            <div id="upload-status-list" style="max-height: 500px; overflow-y: auto;">
                <!-- アップロード状況はJavaScriptで動的に生成 -->
                <div style="text-align: center; padding: 40px 0; color: #6b7280;">
                    <i class="fas fa-spinner fa-spin" style="font-size: 2rem; margin-bottom: 15px;"></i>
                    <p>データを読み込み中...</p>
                </div>
            </div>
        </div>
    </div>
</div>
</body>
</html>